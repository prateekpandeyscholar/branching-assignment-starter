name: Autograde students.md format

on:
  push:
    paths:
      - 'students.md'
  pull_request:
    paths:
      - 'students.md'

jobs:
  check-students-md:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Ensure not committing to main branch
        run: |
          echo "🔍 Checking current branch: ${{ github.ref }}"
          if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            echo "❌ Do not commit directly to the main branch. Create a new branch locally and push."
            exit 1
          else
            echo "✅ Commit is from a feature branch: OK"
          fi

      - name: Check students.md formatting
        run: |
          echo "🔍 Checking students.md formatting..."
          invalid_lines=0

          while IFS= read -r line; do
            echo "$line" | grep -Eq '^- [A-Za-z]+( [A-Za-z]+)* - [A-Za-z0-9]+' || {
              echo "❌ Invalid line: $line"
              invalid_lines=$((invalid_lines+1))
            }
          done < students.md

          if [ "$invalid_lines" -gt 0 ]; then
            echo "❌ Found $invalid_lines incorrectly formatted line(s)."
            exit 1
          else
            echo "✅ All lines formatted correctly!"
          fi
